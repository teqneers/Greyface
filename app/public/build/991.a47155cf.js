"use strict";(self.webpackChunk_teqneers_greyface=self.webpackChunk_teqneers_greyface||[]).push([[991],{6991:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var a=n(4467),r=(n(4114),n(2953),n(6540)),o=n(5942),i=n(6347),c=n(5705),l=n(201),s=n(7839),d=n(6076),m=n(166),u=n(2693),b=(n(3110),n(2735)),h=n(4195),p=n(3096),y=n(8168),g=n(45),E=n(5378),f=n(8032),O=n(4479),S=n(1105),A=n(1100),k=n(5615),C=n(8084),v=n(4002),j=n(1005),w=n(3043);const P=["createMode","onSubmit","submitBtn","onCancel"];function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const M=function(e){let{createMode:t=!0,onSubmit:n,submitBtn:a,onCancel:o}=e,i=(0,g.A)(e,P);const{t:c}=(0,h.Bd)();return r.createElement(C.l1,(0,y.A)({validateOnBlur:!0,validationSchema:(0,v.a5)(c),onSubmit:e=>{let a=e;t||(a=B(B({},e),{},{domain:e.domain[0]})),n.mutate(a)}},i),(e=>{let{handleSubmit:i,handleChange:l,values:s,errors:d,isSubmitting:m}=e;return r.createElement(E.A,{noValidate:!0,onSubmit:i},r.createElement(f.A.Body,null,r.createElement(O.A,{className:"mb-3"},r.createElement(C.ED,{name:"domain",render:e=>{s.domain&&0!==s.domain.length||(s.domain=[""]);const n=s.domain.length;return r.createElement(r.Fragment,null,s.domain.map(((a,o)=>{var i,m;return r.createElement(E.A.Group,{key:o,as:S.A,md:"12",className:"mt-2"},r.createElement(E.A.Label,null,c("blacklist.domain.domain")),r.createElement(A.A,null,r.createElement(E.A.Control,{type:"text",name:"domain[".concat(o,"]"),value:s.domain[o],onChange:l,isInvalid:d.domain instanceof Array?!(null===(i=d.domain)||void 0===i||!i[o]):!!d.domain}),t&&n>1&&r.createElement(k.A,{variant:"outline-warning",onClick:()=>e.remove(o)},"X"),r.createElement(E.A.Control.Feedback,{type:"invalid"},d.domain instanceof Array?null===(m=d.domain)||void 0===m?void 0:m[o]:d.domain)))})),t&&n<5&&r.createElement(k.A,{variant:"link",className:"mt-2 m-auto w-75",onClick:()=>e.push("")},c("placeholder.addMore")))}}))),r.createElement(f.A.Footer,null,r.createElement(j.A,{onClick:()=>o()}),r.createElement(w.A,{label:a,disabled:m&&!n.isError})))}))},F=e=>{let{onCancel:t,onCreate:n}=e;const[a,i]=(0,r.useState)(null),{t:l}=(0,h.Bd)(),{apiUrl:s}=(0,c.Y)(),d=(0,o.useMutation)((async e=>await fetch("".concat(s,"/opt-in/domains"),{method:"POST",body:JSON.stringify(e)}).then((function(e){if(!e.ok)throw e;return i(null),e})).then((e=>e.json())).catch((e=>{e.json().then((e=>{i(e.error)}))}))),{onSuccess:async()=>{n()}});return r.createElement(p.A,{title:"blacklist.domain.addHeader",onHide:()=>t()},a&&r.createElement(b.A,{key:"danger",variant:"danger"},a),r.createElement(M,{initialValues:{domain:[]},onSubmit:d,onCancel:t,submitBtn:l("button.save")}))};var H=n(2473),Q=n(914),U=n(4821);const N=e=>{let{onDelete:t,data:n}=e;const{t:a}=(0,h.Bd)(),{apiUrl:i}=(0,c.Y)(),[l,s]=(0,r.useState)(!1),d=(0,o.useMutation)((e=>fetch("".concat(i,"/opt-in/domains/delete"),{method:"DELETE",body:JSON.stringify({domain:e.domain})}).then((async e=>{const n=await e.json();if(!e.ok){const t=n&&n.message||e.status;return Promise.reject(t)}t()})).catch((e=>{console.error("There was an error!",e)}))));return r.createElement(r.Fragment,null,r.createElement(Q.A,{onClick:()=>s(!0)}),r.createElement(U.A,{show:l,onConfirm:()=>d.mutateAsync(n),onCancel:()=>s(!1),title:"blacklist.domain.deleteHeader"},a("blacklist.domain.deleteMessage")))},x=e=>{let{onUpdate:t,data:n}=e;const{t:a}=(0,h.Bd)(),{apiUrl:i}=(0,c.Y)(),[l,s]=(0,r.useState)(!1),[m,u]=(0,r.useState)(null),y=(0,o.useMutation)((async e=>await fetch("".concat(i,"/opt-in/domains/edit"),{method:"PUT",body:JSON.stringify({dynamicID:{domain:n.domain},domain:e.domain})}).then((function(e){if(!e.ok)throw e;return u(null),e})).then((e=>e.json())).catch((e=>{e.json().then((e=>{u(e.error)}))}))),{onSuccess:async()=>{t()}});return r.createElement(r.Fragment,null,r.createElement(d.A,{label:"button.edit",onClick:()=>s(!0)}),r.createElement(p.A,{show:l,title:"blacklist.domain.editHeader",onHide:()=>s(!1)},m&&r.createElement(b.A,{key:"danger",variant:"danger"},m),r.createElement(M,{initialValues:{domain:[n.domain]},onSubmit:y,createMode:!1,onCancel:()=>s(!1),submitBtn:a("button.save")})))},q=e=>{let{data:t,refetch:n,isFetching:a,pageCount:o,initialState:i,onStateChange:c}=e;const{t:l}=(0,h.Bd)(),s=(0,r.useMemo)((()=>[{Header:l("blacklist.domain.domain"),id:"domain",accessor:e=>e.domain,canSort:!0,disableResizing:!0},{Header:"",id:"actions",width:100,minWidth:100,maxWidth:100,disableSortBy:!0,disableResizing:!0,Cell:e=>{let{row:{original:t}}=e;return r.createElement(r.Fragment,null,r.createElement(x,{onUpdate:n,data:t}),r.createElement(N,{onDelete:n,data:t}))}}]),[l,n]);return a?r.createElement(m.A,null):r.createElement(H.A,{idColumn:"domain",data:t,pageCount:o,columns:s,disableSortRemove:!0,onStateChange:c,initialState:i})};function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const T=()=>{var e;const t=(0,i.W6)(),{apiUrl:n}=(0,c.Y)(),{path:a,url:b}=(0,i.W5)(),{blacklistDomain:h}=(0,s.t0)(),[p,y]=(0,r.useState)(h),[g,E]=(0,r.useState)(null!==(e=h.searchQuery)&&void 0!==e?e:""),f=(0,r.useCallback)((e=>{(0,s.ZC)("blacklistDomain",I(I({},e),{},{searchQuery:g})),y((t=>I(I(I({},t),e),{},{searchQuery:g})))}),[g]);(0,r.useEffect)((()=>{const e=I(I({},p),{},{pageIndex:0,searchQuery:g});(0,s.ZC)("blacklistDomain",e),y(e)}),[g]);const{isLoading:O,isError:S,error:A,data:k,isFetching:C,refetch:v}=(0,o.useQuery)(["opt-in","domains",p,g],(()=>{let e="".concat(n,"/opt-in/domains?start=").concat(p.pageIndex,"&max=").concat(p.pageSize,"&query=").concat(g);return p.sortBy[0]&&(e+="&sortBy=".concat(p.sortBy[0].id,"&desc=").concat(p.sortBy[0].desc?1:0)),fetch(e).then((e=>e.json()))}),{keepPreviousData:!0});return O?r.createElement(m.A,null):r.createElement(l.A,{title:"blacklist.domain.header"},r.createElement(u.A,{title:"blacklist.domain.header",buttons:r.createElement(d.A,{label:"button.addDomain",onClick:()=>t.push("".concat(b,"/add"))}),searchQuery:g,setSearchQuery:E}),S?r.createElement("div",null,"Error: ",A):r.createElement(q,{data:k.results,refetch:v,pageCount:Math.ceil(k.count/p.pageSize),isFetching:C||O,initialState:p,onStateChange:f}),r.createElement(i.qh,{path:"".concat(a,"/add")},r.createElement(F,{onCancel:()=>t.push(b),onCreate:()=>{t.push(b),v()}})))}}}]);